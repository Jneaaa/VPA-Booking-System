<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Dashboard - Manage Equipment</title>
    <!-- Combined CSS resources -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/admin-styles.css" />
    <style src="css/equipment.css"></style>
  </head>

  <body>
    <!-- Top Bar -->
    <header
      id="topbar"
      class="d-flex justify-content-between align-items-center"
    >
      <div class="d-flex align-items-center">
        <img
          src="../cpu-logo.png"
          alt="CPU Logo"
          class="me-2"
          style="height: 40px"
        />
        <span class="fw-bold">CPU Facilities and Equipment Management</span>
      </div>
      <div class="d-flex align-items-center">
        <!--Notifications-->
        <div class="position-relative me-3">
          <div class="dropdown">
            <i
              class="bi bi-bell fs-4 position-relative"
              id="notificationIcon"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            ></i>
            <span class="notification-badge">1</span>
            <ul
              class="dropdown-menu dropdown-menu-end p-0"
              id="notificationDropdown"
              aria-labelledby="notificationIcon"
            >
              <li class="dropdown-header">Notifications</li>
              <li>
                <a
                  href="#"
                  class="notification-item unread d-block"
                  data-notification-id="1"
                >
                  <div class="notification-title">New Equipment Request</div>
                  <div class="notification-text">
                    John Smith requested a Microphone for March 15, 2024
                  </div>
                  <div class="notification-time">2 minutes ago</div>
                </a>
              </li>
              <li>
                <a href="#" class="notification-item d-block">
                  <div class="notification-title">Booking Approved</div>
                  <div class="notification-text">
                    Your equipment request for the sound system has been
                    approved
                  </div>
                  <div class="notification-time">3 hours ago</div>
                </a>
              </li>
              <li>
                <hr class="dropdown-divider m-0" />
              </li>
              <li>
                <a href="#" class="dropdown-item view-all-item text-center"
                  >View all notifications</a
                >
              </li>
            </ul>
          </div>
        </div>
        <!-- Dropdown Menu -->
        <div class="dropdown">
          <button
            class="btn btn-link p-0 text-white"
            id="dropdownMenuButton"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          >
            <i class="bi bi-three-dots fs-4"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li>
              <a class="dropdown-item" href="#"
                ><i class="bi bi-gear me-2"></i>Account Settings</a
              >
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
            <li>
              <a class="dropdown-item" href="adminlogin.html"
                ><i class="bi bi-box-arrow-right me-2"></i>Logout</a
              >
            </li>
          </ul>
        </div>
      </div>
    </header>
    <!-- Main Layout -->
    <div id="layout">
      <!-- Sidebar -->
      <nav id="sidebar">
        <div class="text-center mb-4">
          <div class="position-relative d-inline-block">
            <img
              src="assets/admin-pic.jpg"
              alt="Admin Profile"
              class="profile-img rounded-circle"
            />
          </div>
          <h5 class="mt-3 mb-1">John Doe</h5>
          <p class="text-muted mb-0">Head Admin</p>
        </div>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link" href="dashboard.html">
              <i class="bi bi-speedometer2 me-2"></i>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="calendar.html">
              <i class="bi bi-calendar-event me-2"></i>
              Calendar
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="requisitions.html">
              <i class="bi bi-file-earmark-text me-2"></i>
              Requisitions
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="facilities.html">
              <i class="bi bi-building me-2"></i>
              Facilities
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="equipment.html">
              <i class="bi bi-tools me-2"></i>
              Equipment
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="admin-roles-page.html">
              <i class="bi bi-people me-2"></i>
              Admin Roles
            </a>
          </li>
        </ul>
      </nav>

      <!-- Main Content -->
      <main id="main">
        <div class="container-fluid bg-light rounded p-4">
          <div class="container-fluid">
            <!-- Header & Controls -->
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2>Manage Equipment</h2>
              <div>
                <a href="add-equipment.html" class="btn btn-primary">
                  <i class="bi bi-plus-circle-fill me-2"></i>Add New Equipment
                </a>
              </div>
            </div>

            <!-- Filters & Search Bar -->
            <div class="row mb-3 g-2">
              <div class="col-sm-6 col-md-2 col-lg-2">
                <select id="layoutSelect" class="form-select">
                  <option value="grid">Grid Layout</option>
                  <option value="list">List Layout</option>
                </select>
              </div>
              <div class="col-sm-6 col-md-2 col-lg-2">
                <select id="statusFilter" class="form-select">
                  <option value="all">All Statuses</option>
                  <option value="available">Available</option>
                  <option value="reserved">Reserved</option>
                  <option value="unavailable">Unavailable</option>
                  <option value="under maintenance">Under Maintenance</option>
                </select>
              </div>
              <div class="col-sm-6 col-md-2 col-lg-2">
                <select id="departmentFilter" class="form-select">
                  <option value="all">All Departments</option>
                  <!-- Departments will be populated dynamically -->
                </select>
              </div>
              <div class="col-sm-6 col-md-2 col-lg-2">
                <select id="categoryFilter" class="form-select">
                  <option value="all">All Categories</option>
                  <!-- Categories will be populated dynamically -->
                </select>
              </div>
              <div class="col-sm-12 col-md-4 col-lg-4">
                <div class="search-container">
                  <i class="bi bi-search"></i>
                  <input
                    type="text"
                    id="searchInput"
                    class="form-control"
                    placeholder="Search Equipment..."
                  />
                </div>
              </div>
            </div>

            <!-- Equipment List -->

            <div id="facilityContainer" class="row g-3">
              <div class="col-12 text-center py-5" id="loadingIndicator">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading equipment...</p>
              </div>
              <div class="col-12 text-center py-5 d-none" id="noResultsMessage">
                <i class="bi bi-exclamation-circle fs-1 text-muted"></i>
                <p class="mt-2 text-muted">
                  No equipment found matching your criteria
                </p>
              </div>
            </div>
            <!-- Pagination Controls -->
            <div class="d-flex justify-content-center mt-4">
              <nav aria-label="Equipment pagination">
                <ul class="pagination" id="paginationContainer">
                  <li class="page-item disabled" id="prevPage">
                    <a
                      class="page-link"
                      href="#"
                      tabindex="-1"
                      aria-disabled="true"
                      >Previous</a
                    >
                  </li>
                  <li class="page-item active">
                    <a class="page-link" href="#" data-page="1">1</a>
                  </li>
                  <li class="page-item" id="nextPage">
                    <a class="page-link" href="#" data-page="2">Next</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Combined JS resources -->
    <script src="js/global.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const facilityContainer = document.getElementById("facilityContainer");
        const loadingIndicator = document.getElementById("loadingIndicator");
        const noResultsMessage = document.getElementById("noResultsMessage");

        async function fetchEquipment() {
          try {
            loadingIndicator.classList.remove("d-none");
            noResultsMessage.classList.add("d-none");

            const response = await fetch("http://127.0.0.1:8000/api/equipment", {
              headers: {
                Accept: "application/json",
              },
            });

            if (!response.ok) {
              throw new Error(`Error ${response.status}: ${response.statusText}`);
            }

            const data = await response.json();
            const equipmentList = data.data || [];
            renderEquipment(equipmentList);
          } catch (error) {
            console.error("Error fetching equipment:", error);
            loadingIndicator.classList.add("d-none");
            noResultsMessage.classList.remove("d-none");
            noResultsMessage.innerHTML = `<p class="text-danger">Failed to load equipment. Please try again later.</p>`;
          }
        }

        function renderEquipment(equipmentList) {
          loadingIndicator.classList.add("d-none");
          facilityContainer.innerHTML = "";

          if (equipmentList.length === 0) {
            noResultsMessage.classList.remove("d-none");
            return;
          }

          noResultsMessage.classList.add("d-none");

          equipmentList.forEach((equipment) => {
            const primaryImage =
              equipment.images?.[0]?.image_url || "https://via.placeholder.com/150";

            const card = document.createElement("div");
            card.className = "col-md-4 facility-card mb-4";

            card.innerHTML = `
              <div class="card h-100">
                <img src="${primaryImage}" class="card-img-top" alt="${equipment.equipment_name}">
                <div class="card-body d-flex flex-column">
                  <div>
                    <h5 class="card-title">${equipment.equipment_name}</h5>
                    <p class="card-text text-muted">
                      <i class="bi bi-tag-fill text-primary"></i> ${equipment.category?.category_name || "Unknown Category"} |
                      <i class="bi bi-building-fill text-primary"></i> ${equipment.department?.department_name || "Unknown Department"}
                    </p>
                    <p class="text-muted">${equipment.description || "No description available"}</p>
                  </div>
                  <div class="facility-actions mt-auto pt-3">
                    <button class="btn btn-manage btn-flex">Manage</button>
                    <button class="btn btn-outline-danger btn-delete">Delete</button>
                  </div>
                </div>
              </div>
            `;

            facilityContainer.appendChild(card);
          });
        }

        fetchEquipment();
      });
    </script>
  </body>
</html>
