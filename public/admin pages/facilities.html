<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Dashboard - Manage Facilities</title>
  <!-- Combined CSS resources -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/admin-styles.css">
  <style>
    /* Add sharp edges to all elements */
    * {
      border-radius: 0 !important;
    }

    /* Exclude admin photo container and status circle */
    .profile-img {
      border-radius: 50% !important;
    }
    .status-indicator {
      border-radius: 50% !important;
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <header id="topbar" class="d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <img src="../cpu-logo.png" alt="CPU Logo" class="me-2" style="height: 40px;">
      <span class="fw-bold">CPU Facilities and Equipment Management</span>
    </div>
    <div class="d-flex align-items-center">
      <!--Notifications-->
      <div class="position-relative me-3">
        <div class="dropdown">
          <i class="bi bi-bell fs-4 position-relative" id="notificationIcon" data-bs-toggle="dropdown" aria-expanded="false"></i>
          <span class="notification-badge">1</span>
          <ul class="dropdown-menu dropdown-menu-end p-0" id="notificationDropdown" aria-labelledby="notificationIcon">
            <li class="dropdown-header">Notifications</li>
            <li>
              <a href="#" class="notification-item unread d-block" data-notification-id="1">
                <div class="notification-title">New Facility Request</div>
                <div class="notification-text">John Smith requested the Main Auditorium for March 15, 2024</div>
                <div class="notification-time">2 minutes ago</div>
              </a>
            </li>
            <li>
              <a href="#" class="notification-item d-block">
                <div class="notification-title">Booking Approved</div>
                <div class="notification-text">Your equipment request for the sound system has been approved</div>
                <div class="notification-time">3 hours ago</div>
              </a>
            </li>
            <li><hr class="dropdown-divider m-0"></li>
            <li><a href="#" class="dropdown-item view-all-item text-center">View all notifications</a></li>
          </ul>
        </div>
      </div>
      <!-- Dropdown Menu -->
      <div class="dropdown">
        <button class="btn btn-link p-0 text-white" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-three-dots fs-4"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Account Settings</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="adminlogin.html"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </header>
  <!-- Main Layout -->
  <div id="layout">
    <!-- Sidebar -->
    <nav id="sidebar">
      <div class="text-center mb-4">
        <div class="position-relative d-inline-block">
          <img src="assets/admin-pic.jpg" alt="Admin Profile" class="profile-img rounded-circle">
        </div>
        <h5 class="mt-3 mb-1">John Doe</h5>
        <p class="text-muted mb-0">Head Admin</p>
      </div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="dashboard.html">
            <i class="bi bi-speedometer2 me-2"></i>
            Dashboard
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="calendar.html">
            <i class="bi bi-calendar-event me-2"></i>
            Calendar
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="requisitions.html">
            <i class="bi bi-file-earmark-text me-2"></i>
            Requisitions
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="facilities.html">
            <i class="bi bi-building me-2"></i>
            Facilities
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="equipment.html">
            <i class="bi bi-tools me-2"></i>
            Equipment
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="admin-roles-page.html">
            <i class="bi bi-people me-2"></i>
            Admin Roles
          </a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main id="main">
        <div class="container-fluid bg-light rounded p-4">
      <div class="container-fluid">
        <!-- Header & Controls -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Manage Facilities</h2>
            <div>
                <a href="add-facility.html" class="btn btn-primary">
                    <i class="bi bi-plus-circle-fill me-2"></i>Add New Facility
                </a>
             </div>
        </div>

       <!-- Filters & Search Bar -->
<div class="row mb-3 g-2">  <!-- Changed gutter to g-2 (smaller gap between columns) -->
    <div class="col-sm-6 col-md-2 col-lg-2">  <!-- Added responsive breakpoints -->
        <select id="layoutSelect" class="form-select">
            <option value="grid">Grid Layout</option>
            <option value="list">List Layout</option>
        </select>
    </div>
    <div class="col-sm-6 col-md-2 col-lg-2">
        <select id="statusFilter" class="form-select">
            <option value="all">All Statuses</option>
            <option value="available">Available</option>
            <option value="unavailable">Unavailable</option>
            <option value="reserved">Reserved</option>
        </select>
    </div>
    <div class="col-sm-6 col-md-2 col-lg-2">
        <select id="departmentFilter" class="form-select">
            <option value="all">All Departments</option>
            <option value="CCS">CCS Department</option>
            <option value="CBA">CBA Department</option>
            <option value="CAS">CAS Department</option>
        </select>
    </div>
    <div class="col-sm-6 col-md-2 col-lg-2">
        <select id="categoryFilter" class="form-select">
            <option value="all">All Categories</option>
            <option value="Sports">Sports Venues</option>
            <option value="Rooms">Rooms</option>
            <option value="Buildings">Buildings</option>
        </select>
    </div>
    <div class="col-sm-12 col-md-4 col-lg-4">
        <div class="search-container">
            <i class="bi bi-search"></i>
            <input type="text" id="searchInput" class="form-control" placeholder="Search Facilities...">
        </div>
    </div>
</div>

        <!-- Facilities List -->
        <div id="facilityContainer" class="row g-3"></div>

        <!-- Pagination Controls -->
        <div class="d-flex justify-content-center mt-4">
            <nav aria-label="Facilities pagination">
                <ul class="pagination">
                    <li class="page-item disabled" id="prevPage">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#" data-page="1">1</a></li>
                    <li class="page-item"><a class="page-link" href="#" data-page="2">2</a></li>
                    <li class="page-item" id="nextPage">
                        <a class="page-link" href="#" data-page="2">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
      </div>
      </div>
    </main>
  </div>

  <!-- Event Modal -->
  <div class="modal fade" id="eventModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Event Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <strong>Title:</strong> <span id="eventTitle"></span>
            </li>
            <li class="list-group-item">
              <strong>Date:</strong> <span id="eventDate"></span>
            </li>
            <li class="list-group-item">
              <strong>Time:</strong> <span id="eventTime">10:00 AM - 12:00 PM</span>
            </li>
            <li class="list-group-item">
              <strong>Description:</strong> <span id="eventDescription"></span>
            </li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
 <!-- Combined JS resources -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="js/global.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const facilityContainer = document.getElementById("facilityContainer");
    const loadingIndicator = document.createElement("div");
    const noResultsMessage = document.createElement("div");

    loadingIndicator.className = "col-12 text-center py-5";
    loadingIndicator.innerHTML = `
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading facilities...</p>
    `;
    facilityContainer.appendChild(loadingIndicator);

    noResultsMessage.className = "col-12 text-center py-5 d-none";
    noResultsMessage.innerHTML = `
      <i class="bi bi-exclamation-circle fs-1 text-muted"></i>
      <p class="mt-2 text-muted">No facilities found matching your criteria</p>
    `;
    facilityContainer.appendChild(noResultsMessage);

    async function fetchFacilities() {
      try {
        loadingIndicator.classList.remove("d-none");
        noResultsMessage.classList.add("d-none");

        const response = await fetch("http://127.0.0.1:8000/api/facilities", {
          headers: {
            Accept: "application/json",
          },
        });

        if (!response.ok) {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        const facilitiesList = data.data || [];
        renderFacilities(facilitiesList);
      } catch (error) {
        console.error("Error fetching facilities:", error);
        loadingIndicator.classList.add("d-none");
        noResultsMessage.classList.remove("d-none");
        noResultsMessage.innerHTML = `<p class="text-danger">Failed to load facilities. Please try again later.</p>`;
      }
    }

    function renderFacilities(facilitiesList) {
      loadingIndicator.classList.add("d-none");
      facilityContainer.innerHTML = "";

      if (facilitiesList.length === 0) {
        noResultsMessage.classList.remove("d-none");
        return;
      }

      noResultsMessage.classList.add("d-none");

      facilitiesList.forEach((facility) => {
        const primaryImage =
          facility.images?.[0]?.image_url || "https://via.placeholder.com/150";

        const card = document.createElement("div");
        card.className = "col-md-4 facility-card mb-4";
        card.dataset.status = facility.status?.status_name || "unknown";
        card.dataset.department = facility.department?.department_name || "unknown";
        card.dataset.category = facility.category?.category_name || "unknown";
        card.dataset.title = facility.facility_name || "unknown";

        const statusClass = facility.status?.status_name?.toLowerCase().replace(/\s+/g, '-') || "unknown";

        card.innerHTML = `
          <div class="card h-100">
            <img src="${primaryImage}" class="card-img-top" alt="${facility.facility_name}">
            <div class="card-body d-flex flex-column">
              <div>
                <h5 class="card-title">${facility.facility_name || "Unknown Facility"}</h5>
                <p class="card-text text-muted">
                  <i class="bi bi-tag-fill text-primary"></i> ${facility.category?.category_name || "Unknown Category"} |
                  <i class="bi bi-diagram-2-fill text-primary"></i> ${facility.subcategory?.subcategory_name || "Unknown Subcategory"} |
                  <i class="bi bi-building-fill text-primary"></i> ${facility.department?.department_name || "Unknown Department"}
                </p>
                <p class="status-${statusClass}" style="color: ${facility.status?.color_code || "#000"};">
                  ${facility.status?.status_name || "Unknown Status"}
                </p>
                <p class="card-text">${String(facility.description || "No description available")}</p>
              </div>
              <div class="facility-actions mt-auto pt-3">
                <button class="btn btn-manage btn-flex">Manage</button>
                <button class="btn btn-outline-danger btn-delete">Delete</button>
              </div>
            </div>
          </div>
        `;

        facilityContainer.appendChild(card);
      });
    }

    fetchFacilities();
  });
  </script>

<!-- Modal for Facility Management -->
<div class="modal fade" id="manageFacilityModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Manage Facility</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Facility management form would go here -->
                <form id="facilityForm">
                    <div class="mb-3">
                        <label for="facilityName" class="form-label">Facility Name</label>
                        <input type="text" class="form-control" id="facilityName">
                    </div>
                    <div class="mb-3">
                        <label for="facilityDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="facilityDescription" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="facilityCategory" class="form-label">Category</label>
                            <select class="form-select" id="facilityCategory">
                                <option value="Sports">Sports Facility</option>
                                <option value="Conference">Conference Room</option>
                                <option value="Religious">Religious Facility</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="facilitySubcategory" class="form-label">Subcategory</label>
                            <input type="text" class="form-control" id="facilitySubcategory">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="facilityDepartment" class="form-label">Department</label>
                            <select class="form-select" id="facilityDepartment">
                                <option value="IT">IT Department</option>
                                <option value="HR">HR Department</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="facilityStatus" class="form-label">Status</label>
                            <select class="form-select" id="facilityStatus">
                                <option value="available">Available</option>
                                <option value="reserved">Reserved</option>
                                <option value="unavailable">Unavailable</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>